# HTB---nopeeking-writeup
HTB - nopeeking writeup

Первым делом открываем бинарь в IDA и смотрим что он из себя представляет. Из беглого статического анализа видно, что бинарь богат функциями ptrace, а также в самом начале main функции присутствует fork, т.е., скорее всего будем иметь дело с межпроцессорным взаимодействием.

(далее я буду объяснять на примере уже разобранного мной бинаря, т.е. в нем будут присутствовать мои обозначения имен функций и переменных)

Итак, в главной функции присутствуют 2 блока кода, которые выполняются в зависимости от рода процесса (дочерний\родительский)

В начале своего исполнения, родительский процесс переходит в режим ожидания дочернего процесса, выполняя бесконечный цикл(функция infinite_xor_canary)
В то же время дочерний процесс исполняет функцию parent_process_attach в которой он начинает отлаживать родителя и выводит его из спячки:

Здесь я должен сделать замечание: Т.к. процессы находятся во взаимной отладке, то трассировать такую программу будет практически нереально рядовыми средствами отладки без потери информационного контекста(я долгое время пытался использовать gdb, отлаживая родительский и дочерний процесс по отдельности, используя функции set follow-fork-mode parent/child, но практически ни к чему я не пришел; более того, утилиты трассировки, к примеру -  strace, сразу же отлетают, т.к. их работа основана на ptrace-вызовах , а процессы уже под отладкой.)

Идем дальше. В обоих блоках кода пристутствуют практически одинаковые функции в которых как раз и происходит весь движ: межпроцессорное общение и проверка нашего флага:
Межпроцессорное взаимодействие реализовано через функцию process_handling, рассмотрим её:

В данной функции происходит чтение определенных байтов из памяти отлаживаемого процесса и, исходя из полученных байтов, производится то или иное действие.
Чтение байтов производится из кода функций, в которых происходит проверка части флага - check1 and check2:

Самое интересное происходит вот здесь: 
Рассмотрим функцию check1(), она практически аналогична check2().
В данной функции реализована проверка половины флага 
Функци
Особое внимание заострим на ключевом моменте: В регист
